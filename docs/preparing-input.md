# Preparing the input data

## Single-cell RNA-seq (scRNA-seq) data

Currently only [10X Genomics](https://www.10xgenomics.com/) data are supported.

For each sample, you need to provide a directory containing the files that are generated by [`CellRanger`](https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/what-is-cell-ranger). Specifically, the directory should be able to be read by [`Seurat::Read_10X()`](https://satijalab.org/seurat/reference/read10x). For example, the directory should contain `matrix.mtx`, `barcodes.tsv` and `features.tsv`.
These files can also be gzipped.

You can also use the `h5` file generated by `CellRanger`.

## Single-cell TCR-seq (scTCR-seq) data

The scTCR-seq data should be paired with the scRNA-seq data. For each sample, you should have both scRNA-seq and scTCR-seq data available. Theoratically, as long as the data can be loaded by [`immunarch::repLoad()`](https://immunarch.com/reference/repLoad.html), it should be fine. However, the pipeline is only tested with the data generated by [`CellRanger`](https://support.10xgenomics.com/single-cell-vdj/software/pipelines/latest/output/annotation). Specifically, the directory should contain `filtered_contig_annotations.csv` file, or at least the `all_contig_annotations.csv` file.

## Metadata

A metadata file is required as an input file for the pipeline. It should be a `TAB` delimited file with 3 required columns:

- `Sample`: A unique id for each sample
- `RNAData`: The directory or `h5` file for single-cell RNA data for this sample, as described above.
- `TCRData`: The directory for single-cell TCR data for this sample as described above.

You can also add other columns to the metadata file. The columns will be added to both:

- meta data of the object loaded by `immunarch::repLoad()` (i.e. `data$meta`)
- meta data of the seurat object loaded by `Seurat::Read10X()` or `Seurat::Read10X_h5()` (i.e. `srtobj@meta.data`)

This file should be provided to `SampleInfo` process. See [`SampleInfo`](./processes/SampleInfo.md) for more details.

An example metadata file can be found [here](https://github.com/pwwang/immunopipe-example/blob/master/data/sample.txt).

## Other optional files

### Genes/Features to visualize for Seurat object

If you have a set of genes/features of interest, you can provide a file with those genes, one gene per line, to `SeuratClusterStats.envs.exprs.genes` for:

- Ridge plots using [`Seurat::RidgePlot()`](https://satijalab.org/seurat/reference/ridgeplot),
- Violin plots using [`Seurat::VlnPlot()`](https://satijalab.org/seurat/reference/vlnplot),
- Feature plots using [`Seurat::FeaturePlot()`](https://satijalab.org/seurat/reference/featureplot),
- Dot plots using [`Seurat::DotPlot()`](https://satijalab.org/seurat/reference/dotplot), and
- Heatmaps using [`Seurat::DoHeatmap()`](https://satijalab.org/seurat/reference/doheatmap).

!!! note
    The genes should exist in the RNA-seq data (i.e `features.tsv` or the `h5` file from cellranger).

See [`SeuratClusterStats`](./processes/SeuratClusterStats.md) for more details.

### Pathways for Gene Set Enrichment Analysis (GSEA)

If you want to perform GSEA, you need to provide a file containing the pathways. The file should be in the [GMT format][1]. You can provide the file to `ScFGSEA.envs.gmtfile`. Similarly, the genes should exist (be in the same format) in the `features.tsv` file.

See [`ScFGSEA`](./processes/ScFGSEA.md) for more details.

### Cell type database for cell type annotation by `sctype` or `hitype`

If you want to perform cell type annotation, you need to provide a file containing the cell type database if you are using `sctype` or `hitype`. The database file should be fed to `CellTypeAnnotation.envs.sctype_db` if you are using `sctype`, or `CellTypeAnnotation.envs.hitype_db` if you are using `hitype`. Again, the markers in the database should exist (be in the same format) in the `features.tsv` file or the `h5` file.

See [`CellTypeAnnotation`](./processes/CellTypeAnnotation.md) for more details.

### Metabolic pathway for Metabolic Landscape Analysis

Similarly, if you want to perform metabolic landscape analysis, you need to provide a file containing the metabolic pathways. The file should be in the [GMT format][1]. You can provide the file to `ScMetabolicLandscape.envs.gmtfile`. This file can also be used for GSEA. A pathway file for KEGG metabolism is provided [here][2].

See [`ScrnaMetabolicLandscape`](./processes/ScrnaMetabolicLandscape.md) for more details.

[1]: https://docs.gsea-msigdb.org/#GSEA/Data_Formats/#gmt-gene-matrix-transposed-file-format-gmt
[2]: https://github.com/pwwang/biopipen/blob/master/tests/data/scrna_metabolic/KEGG_metabolism.gmt
