<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>ModuleScoreCalculator - immunopipe</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "ModuleScoreCalculator";
        var mkdocs_page_input_path = "processes/ModuleScoreCalculator.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.configure({ ignoreUnescapedHTML: true }); hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../rtd-logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="nav-scrollable-wrapper">
      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../introduction/">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../getting-started/">Geting started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../gallery/">Gallery</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../running/">Running the pipeline</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../preparing-input/">Preparing the input</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../configurations/">Configurations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../mcp-server/">MCP Sever</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Processes</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../SampleInfo/">SampleInfo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../LoadingRNAFromSeurat/">LoadingRNAFromSeurat</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SeuratPreparing/">SeuratPreparing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SeuratClusteringOfAllCells/">SeuratClusteringOfAllCells</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ClusterMarkersOfAllCells/">ClusterMarkersOfAllCells</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TopExpressingGenesOfAllCells/">TopExpressingGenesOfAllCells</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TOrBCellSelection/">TOrBCellSelection</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">ModuleScoreCalculator</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#input">Input</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#output">Output</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metadata">Metadata</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SeuratClustering/">SeuratClustering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CellTypeAnnotation/">CellTypeAnnotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SeuratMap2Ref/">SeuratMap2Ref</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ClusterMarkers/">ClusterMarkers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TopExpressingGenes/">TopExpressingGenes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SeuratSubClustering/">SeuratSubClustering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ScRepLoading/">ScRepLoading</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ScRepCombiningExpression/">ScRepCombiningExpression</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TCRClustering/">TCRClustering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TESSA/">TESSA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../SeuratClusterStats/">SeuratClusterStats</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ScFGSEA/">ScFGSEA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MarkersFinder/">MarkersFinder</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PseudoBulkDEG/">PseudoBulkDEG</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ClonalStats/">ClonalStats</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CDR3AAPhyschem/">CDR3AAPhyschem</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CellCellCommunication/">CellCellCommunication</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CellCellCommunicationPlots/">CellCellCommunicationPlots</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Metabolic Landscape Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ScrnaMetabolicLandscape/">Introduction & Group Arguments</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MetabolicInput/">MetabolicInput</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MetabolicExprImputation/">MetabolicExprImputation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MetabolicFeatures/">MetabolicFeatures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MetabolicPathwayActivity/">MetabolicPathwayActivity</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MetabolicPathwayHeterogeneity/">MetabolicPathwayHeterogeneity</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../faq/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG/">Change log</a>
                </li>
              </ul>
      </div>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">immunopipe</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Processes</li>
      <li class="breadcrumb-item active">ModuleScoreCalculator</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/pwwang/immunopipe/blob/dev/docs/processes/ModuleScoreCalculator.md">Edit on pwwang/immunopipe</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="modulescorecalculator">ModuleScoreCalculator<a class="headerlink" href="#modulescorecalculator" title="Permanent link">&para;</a></h2>
<p>Calculate the module scores for each cell</p>
<p>The module scores are calculated by
<a href="https://satijalab.org/seurat/reference/addmodulescore"><code>Seurat::AddModuleScore()</code></a>
or <a href="https://satijalab.org/seurat/reference/cellcyclescoring"><code>Seurat::CellCycleScoring()</code></a>
for cell cycle scores.<br /></p>
<p>The module scores are calculated as the average expression levels of each
program on single cell level, subtracted by the aggregated expression of
control feature sets. All analyzed features are binned based on averaged
expression, and the control features are randomly selected from each bin.<br /></p>
<h3 id="input">Input<a class="headerlink" href="#input" title="Permanent link">&para;</a></h3>
<ul>
<li><code>srtobj</code>:
    The seurat object loaded by <code>SeuratClustering</code></li>
</ul>
<h3 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h3>
<ul>
<li><code>rdsfile</code>: <em>Default: <code>{{in.srtobj | stem}}.qs</code></em>. <br />
    The seurat object with module scores added to the metadata.<br /></li>
</ul>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h3>
<ul>
<li><code>defaults</code> <em>(<code>ns</code>)</em>:
    The default parameters for <code>modules</code>.<br /><ul>
<li><code>features</code>:
    The features to calculate the scores. Multiple features
    should be separated by comma.<br />
    You can also specify <code>cc.genes</code> or <code>cc.genes.updated.2019</code> to
    use the cell cycle genes to calculate cell cycle scores.<br />
    If so, three columns will be added to the metadata, including
    <code>S.Score</code>, <code>G2M.Score</code> and <code>Phase</code>.<br />
    Only one type of cell cycle scores can be calculated at a time.<br /></li>
<li><code>nbin</code> <em>(<code>type=int</code>)</em>: <em>Default: <code>24</code></em>. <br />
    Number of bins of aggregate expression levels
    for all analyzed features.<br /></li>
<li><code>ctrl</code> <em>(<code>type=int</code>)</em>: <em>Default: <code>100</code></em>. <br />
    Number of control features selected from
    the same bin per analyzed feature.<br /></li>
<li><code>k</code> <em>(<code>flag</code>)</em>: <em>Default: <code>False</code></em>. <br />
    Use feature clusters returned from <code>DoKMeans</code>.<br /></li>
<li><code>assay</code>:
    The assay to use.<br /></li>
<li><code>seed</code> <em>(<code>type=int</code>)</em>: <em>Default: <code>8525</code></em>. <br />
    Set a random seed.<br /></li>
<li><code>search</code> <em>(<code>flag</code>)</em>: <em>Default: <code>False</code></em>. <br />
    Search for symbol synonyms for features in
    features that don't match features in object?<br /></li>
<li><code>keep</code> <em>(<code>flag</code>)</em>: <em>Default: <code>False</code></em>. <br />
    Keep the scores for each feature?<br />
    Only works for non-cell cycle scores.<br /></li>
<li><code>agg</code> <em>(<code>choice</code>)</em>: <em>Default: <code>mean</code></em>. <br />
    The aggregation function to use.<br />
    Only works for non-cell cycle scores.<br /><ul>
<li><code>mean</code>:
    The mean of the expression levels</li>
<li><code>median</code>:
    The median of the expression levels</li>
<li><code>sum</code>:
    The sum of the expression levels</li>
<li><code>max</code>:
    The max of the expression levels</li>
<li><code>min</code>:
    The min of the expression levels</li>
<li><code>var</code>:
    The variance of the expression levels</li>
<li><code>sd</code>:
    The standard deviation of the expression levels</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>modules</code> <em>(<code>type=json</code>)</em>: <em>Default: <code>{}</code></em>. <br />
    The modules to calculate the scores.<br />
    Keys are the names of the expression programs and values are the
    dicts inherited from <code>env.defaults</code>.<br />
    Here are some examples -</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="s2">&quot;CellCycle&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="s2">&quot;cc.genes.updated.2019&quot;</span><span class="p">},</span>
    <span class="s2">&quot;Exhaustion&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="s2">&quot;HAVCR2,ENTPD1,LAYN,LAG3&quot;</span><span class="p">},</span>
    <span class="s2">&quot;Activation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="s2">&quot;IFNG&quot;</span><span class="p">},</span>
    <span class="s2">&quot;Proliferation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="s2">&quot;STMN1,TUBB&quot;</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>For <code>CellCycle</code>, the columns <code>S.Score</code>, <code>G2M.Score</code> and <code>Phase</code> will
be added to the metadata. <code>S.Score</code> and <code>G2M.Score</code> are the cell cycle
scores for each cell, and <code>Phase</code> is the cell cycle phase for each cell.<br /></p>
<p>You can also add Diffusion Components (DC) to the modules</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="s2">&quot;DC&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;kind&quot;</span><span class="p">:</span> <span class="s2">&quot;diffmap&quot;</span><span class="p">}}</span>
</code></pre></div>
<p>will perform diffusion map as a reduction and add the first 2
components as <code>DC_1</code> and <code>DC_2</code> to the metadata. <code>diffmap</code> is a shortcut
for <code>diffusion_map</code>. Other key-value pairs will pass to
<a href="https://www.rdocumentation.org/packages/destiny/versions/2.0.4/topics/DiffusionMap class"><code>destiny::DiffusionMap()</code></a>.<br />
You can later plot the diffusion map by using
<code>reduction = "DC"</code> in <code>env.dimplots</code> in <code>SeuratClusterStats</code>.<br />
This requires <a href="https://bioconductor.org/packages/release/bioc/html/SingleCellExperiment.html"><code>SingleCellExperiment</code></a>
and <a href="https://bioconductor.org/packages/release/bioc/html/destiny.html"><code>destiny</code></a> R packages.<br />
- <code>post_mutaters</code> <em>(<code>type=json</code>)</em>: <em>Default: <code>{}</code></em>. <br />
The mutaters to mutate the metadata after
calculating the module scores.<br />
The mutaters will be applied in the order specified.<br />
This is useful when you want to create new scores based on the
calculated module scores.<br /></p>
</li>
</ul>
<h3 id="metadata">Metadata<a class="headerlink" href="#metadata" title="Permanent link">&para;</a></h3>
<p>The metadata of the <code>Seurat</code> object will be updated with the module scores:<br /></p>
<p><img alt="ModuleScoreCalculator-metadata" src="../..//processes/images/ModuleScoreCalculator-metadata.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../TOrBCellSelection/" class="btn btn-neutral float-left" title="TOrBCellSelection"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../SeuratClustering/" class="btn btn-neutral float-right" title="SeuratClustering">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  <div class="footer-notes">
    
    Version: <div id="mike-versions"></div>
    <div class="footer-sep"></div>
    <a href="https://github.com/pwwang/immunopipe" title="Open repository in GitHub">Github Repo</a>
    <div class="footer-sep"></div>Built with <a href="https://www.mkdocs.org/">MkDocs</a> using theme <a href="https://github.com/pwwang/mkdocs-rtd">mkdocs-rtd</a>.
  </div>
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../TOrBCellSelection/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../SeuratClustering/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
    <script src="../../js/version-select.js"></script>
      <script src="../../assets/script.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
